<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURAL OS v10.0 // ULTIMATE_EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=VT323&family=Share+Tech+Mono&display=swap');

        :root {
            --primary-hue: 180; /* Cyan default */
            --primary: hsl(var(--primary-hue), 100%, 50%);
            --secondary: hsl(calc(var(--primary-hue) + 180), 100%, 50%);
            --bg: #050505;
            --glass: hsla(var(--primary-hue), 100%, 50%, 0.1);
            --scanline-opacity: 0.15;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--bg);
            color: var(--primary);
            overflow: hidden;
            cursor: crosshair;
            user-select: none;
            transition: color 0.2s;
        }

        /* --- RESPONSIVE ADJUSTMENTS --- */
        @media (max-width: 1024px) {
            body { overflow: hidden; }
            .window-panel {
                position: relative !important;
                top: auto !important; left: auto !important;
                width: 90% !important; max-width: 500px;
                margin: 0 auto 20px auto; min-width: 0 !important;
            }
            #dashboard-stage {
                overflow-y: auto !important; display: flex; flex-direction: column;
                padding-top: 70px; padding-bottom: 40px;
            }
            .window-content { max-height: 250px; }
            .taskbar-hide-mobile { display: none; }
            
            #browser-stage {
                position: fixed !important;
                width: 100vw !important; height: 100vh !important;
                top: 0 !important; left: 0 !important;
                margin: 0 !important; max-width: none !important;
                border: none !important; border-radius: 0 !important;
                z-index: 10000 !important;
            }
        }

        /* --- CRT OVERLAY --- */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none; z-index: 9999;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
            animation: flicker 0.15s infinite;
            opacity: var(--scanline-opacity);
            transition: opacity 0.3s;
        }
        @keyframes flicker { 0% { opacity: var(--scanline-opacity); } 1% { opacity: calc(var(--scanline-opacity) * 0.9); } 100% { opacity: var(--scanline-opacity); } }

        /* --- BOOT SCREEN --- */
        #boot-screen {
            position: fixed; inset: 0; background: #000; z-index: 100;
            padding: 2rem; display: flex; flex-direction: column; justify-content: flex-end;
            font-family: 'VT323', monospace; font-size: 1.2rem; color: #ccc; text-shadow: 0 0 5px #ccc;
        }
        .boot-line { margin: 2px 0; }

        /* --- WINDOWS --- */
        .window-panel {
            position: absolute;
            background: rgba(10, 15, 30, 0.9); backdrop-filter: blur(8px);
            border: 1px solid var(--primary); box-shadow: 0 0 20px hsla(var(--primary-hue), 100%, 50%, 0.15);
            color: #fff; display: flex; flex-direction: column;
            transition: box-shadow 0.2s, border-color 0.2s; min-width: 300px;
        }
        .window-panel:active, .window-panel:focus-within { 
            box-shadow: 0 0 30px hsla(var(--primary-hue), 100%, 50%, 0.4); 
            z-index: 50; 
            border-color: #fff;
        }
        .window-header {
            background: rgba(255, 255, 255, 0.05); padding: 6px 12px; cursor: grab;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--primary); font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem; letter-spacing: 1px; color: var(--primary);
        }
        .window-header:active { cursor: grabbing; }
        .window-content { padding: 16px; overflow-y: auto; max-height: 400px; position: relative; }

        /* --- WINDOW HOVER EFFECT --- */
        .window-panel::before {
            content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, var(--primary), transparent, var(--primary));
            z-index: -1; opacity: 0; transition: opacity 0.3s;
        }
        .window-panel:hover::before { opacity: 0.3; }

        /* --- TERMINAL --- */
        .terminal-text { font-family: 'VT323', monospace; font-size: 1.1rem; color: var(--primary); line-height: 1.2; }

        /* --- FINGERPRINT (FALLBACK) --- */
        .fingerprint-container {
            position: relative; width: 80px; height: 80px; margin: 0 auto 20px;
            cursor: pointer; transition: transform 0.2s;
        }
        .fingerprint-container:active { transform: scale(0.95); }
        .fingerprint-icon { font-size: 80px; color: rgba(255,255,255,0.1); transition: color 0.5s; }
        .fingerprint-container:hover .fingerprint-icon { color: rgba(255,255,255,0.3); }
        .scan-beam {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: var(--primary); box-shadow: 0 0 15px var(--primary);
            opacity: 0; pointer-events: none;
        }
        .scanning .scan-beam { opacity: 1; animation: scanMove 1.5s ease-in-out infinite; }
        .scanning .fingerprint-icon { color: var(--primary); text-shadow: 0 0 15px var(--primary); }
        @keyframes scanMove { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

        /* --- FACE SCAN (PRIMARY) --- */
        #face-feed-container {
            position: relative; width: 280px; height: 200px; margin: 0 auto 20px;
            border: 1px solid var(--primary); overflow: hidden; background: #000;
            display: none; /* Hidden by default */
        }
        #webcam-video {
            width: 100%; height: 100%; object-fit: cover;
            transform: scaleX(-1); /* Mirror */
            filter: grayscale(100%) sepia(100%) hue-rotate(130deg) brightness(0.8) contrast(1.2);
            opacity: 0.8;
        }
        .face-hud-corner {
            position: absolute; width: 20px; height: 20px;
            border: 2px solid var(--primary); z-index: 10;
        }
        .tl { top: 5px; left: 5px; border-bottom: none; border-right: none; }
        .tr { top: 5px; right: 5px; border-bottom: none; border-left: none; }
        .bl { bottom: 5px; left: 5px; border-top: none; border-right: none; }
        .br { bottom: 5px; right: 5px; border-top: none; border-left: none; }
        
        .face-scan-line {
            position: absolute; width: 100%; height: 2px; background: var(--primary);
            box-shadow: 0 0 10px var(--primary); top: 0; left: 0; z-index: 11;
            animation: faceScan 2s linear infinite;
        }
        @keyframes faceScan { 0% { top: 0; opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { top: 100%; opacity: 0; } }

        /* --- KEYPAD --- */
        .cyber-btn {
            background: rgba(0, 0, 0, 0.3); border: 1px solid var(--primary); color: var(--primary);
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .cyber-btn:hover { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }
        .cyber-btn:active { transform: scale(0.95); }

        /* --- UTILS --- */
        #matrix-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.15; }
        .hidden-el { display: none !important; }
        .fade-in { animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        ::-webkit-scrollbar-track { background: #000; }

        /* --- SCANNER BUTTON --- */
        .scanner-btn { position: relative; overflow: hidden; }
        .scanner-btn::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transform: skewX(-25deg);
        }
        .scanner-btn.scanning::after { animation: scanBtn 1s linear infinite; }
        @keyframes scanBtn { 0% { left: -100%; } 100% { left: 200%; } }

        /* --- SMOOTH ANIMATIONS --- */
        #password-modal {
            transition: opacity 0.3s ease, backdrop-filter 0.3s ease; opacity: 0; pointer-events: none;
        }
        #password-modal.modal-visible { opacity: 1; pointer-events: auto; }
        #password-modal .window-panel {
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); transform: scale(0.9) translateY(20px);
        }
        #password-modal.modal-visible .window-panel { transform: scale(1) translateY(0); }
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.8); filter: blur(4px); } 100% { opacity: 1; transform: scale(1); filter: blur(0); } }
        .file-item { opacity: 0; animation: popIn 0.4s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        @keyframes slideUpFade { 0% { opacity: 0; transform: translateY(5px); } 100% { opacity: 1; transform: translateY(0); } }
        .status-animate { animation: slideUpFade 0.3s ease-out forwards; }

        /* --- BROWSER OVERLAY FIX --- */
        #browser-stage { z-index: 10000 !important; }

        /* --- AI CHAT SPECIFIC --- */
        .msg-bubble { padding: 8px 12px; margin-bottom: 8px; border-radius: 4px; max-width: 90%; word-wrap: break-word; font-size: 11px; line-height: 1.4; }
        .msg-user { align-self: flex-end; background: var(--primary); color: #000; border: 1px solid var(--primary); }
        .msg-ai { align-self: flex-start; background: rgba(255, 255, 255, 0.1); border: 1px solid var(--primary); color: var(--primary); transition: background-color 0.2s; white-space: pre-wrap; }
        .typing-dot { display: inline-block; width: 4px; height: 4px; border-radius: 50%; background-color: var(--primary); margin: 0 1px; animation: bounce 1.4s infinite ease-in-out; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* --- DESIGN BUTTON EFFECT --- */
        .design-btn-wrapper {
            --dot-size: 4px; --line-weight: 1px; --line-distance: 0.9rem 1.1rem; --animation-speed: 0.35s; --dot-color: var(--primary); --line-color: hsla(var(--primary-hue), 100%, 50%, 0.5);
            position: relative; display: flex; justify-content: center; align-items: center; width: auto; height: auto; padding: var(--line-distance); background-color: transparent; transition: background-color 0.3s ease-in-out; user-select: none; margin: 10px auto;
        }
        .design-btn-wrapper:has(.design-btn:hover) { animation: backround-color-change calc(var(--animation-speed) * 4) ease-in-out forwards; }
        @keyframes backround-color-change { 80% { background-color: transparent; } 100% { background-color: hsla(var(--primary-hue), 100%, 50%, 0.1); } }
        .design-btn {
            position: relative; display: flex; justify-content: center; align-items: center; padding: 0.8rem 1.25rem; background-color: var(--primary);
            background-image: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.4)); border: none; color: #000; font-family: 'Share Tech Mono', monospace; font-size: 1rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; border-radius: 2px; cursor: pointer; box-shadow: 0 0 10px var(--primary); transition: all 0.2s ease-in-out; clip-path: polygon(10% 0, 100% 0, 100% 80%, 90% 100%, 0 100%, 0 20%);
        }
        .design-btn:hover { background-color: #fff; transform: scale(1.05); box-shadow: 0 0 20px var(--primary); }
        .design-btn:active { background-color: var(--primary); transform: scale(0.98); }
        .design-btn-svg { margin-left: 0.5rem; height: 20px; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; stroke: #000; fill: none; transition: all 0.3s ease-in-out; }
        .design-dot { position: absolute; width: var(--dot-size); aspect-ratio: 1; border-radius: 50%; background-color: var(--dot-color); transition: all 0.3s ease-in-out; opacity: 0; box-shadow: 0 0 5px var(--primary); }
        .design-btn-wrapper:has(.design-btn:hover) .design-dot.top.left { top: 50%; left: 20%; animation: move-top-left var(--animation-speed) ease-in-out forwards; }
        @keyframes move-top-left { 90% { opacity: 0.6; } 100% { top: calc(var(--dot-size) * -0.5); left: calc(var(--dot-size) * -0.5); opacity: 1; } }
        .design-btn-wrapper:has(.design-btn:hover) .design-dot.top.right { top: 50%; right: 20%; animation: move-top-right var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 0.6); }
        @keyframes move-top-right { 80% { opacity: 0.6; } 100% { top: calc(var(--dot-size) * -0.5); right: calc(var(--dot-size) * -0.5); opacity: 1; } }
        .design-btn-wrapper:has(.design-btn:hover) .design-dot.bottom.right { bottom: 50%; right: 20%; animation: move-bottom-right var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 1.2); }
        @keyframes move-bottom-right { 80% { opacity: 0.6; } 100% { bottom: calc(var(--dot-size) * -0.5); right: calc(var(--dot-size) * -0.5); opacity: 1; } }
        .design-btn-wrapper:has(.design-btn:hover) .design-dot.bottom.left { bottom: 50%; left: 20%; animation: move-bottom-left var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 1.8); }
        @keyframes move-bottom-left { 80% { opacity: 0.6; } 100% { bottom: calc(var(--dot-size) * -0.5); left: calc(var(--dot-size) * -0.5); opacity: 1; } }
        .design-line { position: absolute; transition: all 0.3s ease-in-out; }
        .design-line.horizontal { height: var(--line-weight); width: 100%; background-image: repeating-linear-gradient(90deg, transparent 0 calc(var(--line-weight) * 2), var(--line-color) calc(var(--line-weight) * 2) calc(var(--line-weight) * 4)); }
        .design-line.top { top: calc(var(--line-weight) * -0.5); transform-origin: top left; transform: rotate(5deg) scaleX(0); }
        .design-btn-wrapper:has(.design-btn:hover) .design-line.top { animation: draw-top var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 0.8); }
        @keyframes draw-top { 100% { transform: rotate(0deg) scaleX(1); } }
        .design-line.bottom { bottom: calc(var(--line-weight) * -0.5); transform-origin: bottom right; transform: rotate(5deg) scaleX(0); }
        .design-btn-wrapper:has(.design-btn:hover) .design-line.bottom { animation: draw-bottom var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 2); }
        @keyframes draw-bottom { 100% { transform: rotate(0deg) scaleX(1); } }
        .design-line.vertical { width: var(--line-weight); height: 100%; background-image: repeating-linear-gradient(0deg, transparent 0 calc(var(--line-weight) * 2), var(--line-color) calc(var(--line-weight) * 2) calc(var(--line-weight) * 4)); }
        .design-line.left { left: calc(var(--line-weight) * -0.5); transform-origin: bottom left; transform: rotate(0deg) scaleY(0); }
        .design-btn-wrapper:has(.design-btn:hover) .design-line.left { animation: draw-left var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 2.4); }
        @keyframes draw-left { 100% { transform: rotate(0deg) scaleY(1); } }
        .design-line.right { right: calc(var(--line-weight) * -0.5); transform-origin: top right; transform: rotate(5deg) scaleY(0); }
        .design-btn-wrapper:has(.design-btn:hover) .design-line.right { animation: draw-right var(--animation-speed) ease-in-out forwards; animation-delay: calc(var(--animation-speed) * 1.4); }
        @keyframes draw-right { 100% { transform: rotate(0deg) scaleY(1); } }

        /* --- NEW CREATIVE TOOLS STYLES --- */
        .color-swatch { width: 30px; height: 30px; border: 1px solid #fff; cursor: pointer; transition: transform 0.2s; }
        .color-swatch:hover { transform: scale(1.1); }
        .net-node { cursor: pointer; transition: r 0.2s; }
        .net-node:hover { r: 8; }
        
        /* Threat Map Dots */
        .threat-dot {
            position: absolute; width: 6px; height: 6px; background-color: red; border-radius: 50%;
            animation: pulseThreat 1s infinite;
        }
        @keyframes pulseThreat { 0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 70% { transform: scale(2); opacity: 0; box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); } 100% { transform: scale(1); opacity: 0; } }
        
        /* Signal Bar */
        .signal-bar { width: 8px; background-color: var(--primary); margin: 0 1px; transition: height 0.05s, background-color 0.2s; opacity: 0.8; }
        
        /* Brute Force */
        .hash-row { font-family: 'VT323', monospace; color: var(--primary); opacity: 0.7; font-size: 14px; line-height: 1.2; }
        
        /* Orbital Uplink */
        .globe-wire { stroke: var(--primary); fill: none; stroke-width: 0.5px; opacity: 0.5; }
        .globe-container { perspective: 1000px; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .globe { width: 150px; height: 150px; border-radius: 50%; border: 1px solid var(--primary); position: relative; animation: rotateGlobe 10s linear infinite; transform-style: preserve-3d; box-shadow: inset 0 0 20px var(--primary); }
        .globe-ring { position: absolute; top: 50%; left: 50%; width: 200px; height: 200px; border: 1px dashed var(--secondary); border-radius: 50%; transform: translate(-50%, -50%) rotateX(70deg); animation: rotateRing 5s linear infinite reverse; }
        @keyframes rotateGlobe { 0% { transform: rotateY(0); } 100% { transform: rotateY(360deg); } }
        @keyframes rotateRing { 0% { transform: translate(-50%, -50%) rotateX(70deg) rotateZ(0); } 100% { transform: translate(-50%, -50%) rotateX(70deg) rotateZ(360deg); } }

        /* --- DESKTOP HUD --- */
        #desktop-hud { pointer-events: none; z-index: 0; }
        .hud-corner { position: absolute; width: 50px; height: 50px; border: 2px solid var(--primary); opacity: 0.5; }
        .hud-tl { top: 20px; left: 20px; border-bottom: none; border-right: none; }
        .hud-tr { top: 20px; right: 20px; border-bottom: none; border-left: none; }
        .hud-bl { bottom: 60px; left: 20px; border-top: none; border-right: none; }
        .hud-br { bottom: 60px; right: 20px; border-top: none; border-left: none; }
        
        .hud-radar {
            position: absolute; bottom: 80px; right: 40px; width: 120px; height: 120px;
            border: 1px solid var(--primary); border-radius: 50%;
            background: radial-gradient(circle, rgba(0,243,255,0.1) 0%, transparent 70%);
            opacity: 0.6;
        }
        .hud-radar::after {
            content: ''; position: absolute; top: 50%; left: 50%; width: 50%; height: 2px;
            background: var(--primary); transform-origin: 0 0;
            animation: radarSpin 4s linear infinite;
        }
        @keyframes radarSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .hud-log {
            position: absolute; bottom: 80px; left: 40px; font-family: 'VT323', monospace;
            font-size: 12px; color: var(--primary); opacity: 0.4;
            max-height: 100px; overflow: hidden; display: flex; flex-direction: column-reverse;
        }
        
    </style>
</head>
<body>

    <div id="boot-screen"></div>
    <div class="crt-overlay"></div>
    <canvas id="matrix-canvas"></canvas>

    <!-- LOGIN STAGE -->
    <div id="login-stage" class="hidden-el h-screen w-full flex items-center justify-center relative z-10 transition-all duration-700 px-4">
        <div id="login-panel" class="w-full max-w-[420px] bg-black/80 border border-current p-8 backdrop-blur-xl relative overflow-hidden" style="border-color: var(--primary);">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-current to-transparent" style="color: var(--primary)"></div>
            <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-current to-transparent" style="color: var(--primary)"></div>
            <div class="text-center mb-8"><h1 class="text-3xl font-black tracking-[0.2em] text-white" style="text-shadow: 0 0 10px var(--primary)">NEURAL_GATE</h1><p class="text-[10px] opacity-70 mt-2 tracking-[0.3em]">SECURE ACCESS POINT // V10.0</p></div>
            <div id="bio-phase" class="flex flex-col items-center justify-center py-6">
                <div id="face-feed-container"><video id="webcam-video" autoplay playsinline muted></video><div class="face-hud-corner tl"></div><div class="face-hud-corner tr"></div><div class="face-hud-corner bl"></div><div class="face-hud-corner br"></div><div class="face-scan-line"></div><div class="absolute inset-0 bg-gradient-to-b from-transparent to-black/50 z-20"></div></div>
                <div id="fingerprint-wrapper"><div id="bio-scanner" class="fingerprint-container" onmousedown="startScan()" onmouseup="stopScan()" onmouseleave="stopScan()" ontouchstart="startScan()" ontouchend="stopScan()"><i class="fas fa-fingerprint fingerprint-icon"></i><div class="scan-beam"></div></div></div>
                <p id="bio-text" class="text-xs font-mono animate-pulse mt-4" style="color: var(--primary)">INITIALIZING SENSORS...</p>
                <div class="w-full h-1 bg-gray-900 mt-4 rounded-full overflow-hidden"><div id="bio-progress" class="h-full w-0 transition-all duration-100 ease-linear" style="background-color: var(--primary)"></div></div>
                <button id="manual-fallback-btn" onclick="forceFingerprintMode()" class="hidden-el mt-4 text-[9px] text-red-400 border border-red-900 px-2 py-1 hover:bg-red-900/20"><i class="fas fa-exclamation-triangle mr-1"></i> USE MANUAL AUTH</button>
            </div>
            <div id="pin-phase" class="hidden-el fade-in">
                <div class="mb-6 relative"><div class="flex justify-between text-[10px] text-gray-500 mb-1 font-mono"><span>REQ: DIGIT PIN</span><span id="pin-hint">[ Hint: Unknown ]</span></div><div id="pin-display" class="h-14 bg-black border border-current flex items-center justify-center text-3xl tracking-[1em] font-sans relative shadow-inner" style="color: var(--primary); border-color: var(--primary);"></div><p id="pin-msg" class="text-center text-xs text-red-500 font-bold mt-2 h-4 opacity-0">INVALID CODE</p></div>
                <div class="grid grid-cols-3 gap-4"><button onclick="pressKey(1)" class="cyber-btn h-12 text-xl font-bold">1</button><button onclick="pressKey(2)" class="cyber-btn h-12 text-xl font-bold">2</button><button onclick="pressKey(3)" class="cyber-btn h-12 text-xl font-bold">3</button><button onclick="pressKey(4)" class="cyber-btn h-12 text-xl font-bold">4</button><button onclick="pressKey(5)" class="cyber-btn h-12 text-xl font-bold">5</button><button onclick="pressKey(6)" class="cyber-btn h-12 text-xl font-bold">6</button><button onclick="pressKey(7)" class="cyber-btn h-12 text-xl font-bold">7</button><button onclick="pressKey(8)" class="cyber-btn h-12 text-xl font-bold">8</button><button onclick="pressKey(9)" class="cyber-btn h-12 text-xl font-bold">9</button><button onclick="clearPin()" class="cyber-btn h-12 text-sm font-bold border-red-500 text-red-500">CLR</button><button onclick="pressKey(0)" class="cyber-btn h-12 text-xl font-bold">0</button><button onclick="submitPin()" class="cyber-btn h-12 text-sm font-bold bg-white/10">ENT</button></div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard-stage" class="hidden-el fixed inset-0 z-20 overflow-hidden lg:overflow-hidden opacity-0 transition-opacity duration-1000">
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_#111827_0%,_#000000_100%)] z-[-1]"></div>
        
        <!-- DESKTOP HUD DECORATION -->
        <div id="desktop-hud" class="absolute inset-0 w-full h-full">
            <div class="hud-corner hud-tl"></div>
            <div class="hud-corner hud-tr"></div>
            <div class="hud-corner hud-bl"></div>
            <div class="hud-corner hud-br"></div>
            <div class="absolute top-6 left-20 text-[10px] font-mono text-[var(--primary)] opacity-50 tracking-[0.2em]">NEURAL_OS // KERNEL_ACCESS_LEVEL_5</div>
            <div class="hud-radar"></div>
            <div class="hud-log" id="system-log-bg">
                <div>> SYSTEM_INTEGRITY: 100%</div>
                <div>> NETWORK_STATUS: ONLINE</div>
                <div>> DAEMON_V4.2: RUNNING</div>
            </div>
            <div class="absolute inset-0 opacity-10" style="background-image: linear-gradient(0deg, transparent 24%, var(--primary) 25%, var(--primary) 26%, transparent 27%, transparent 74%, var(--primary) 75%, var(--primary) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, var(--primary) 25%, var(--primary) 26%, transparent 27%, transparent 74%, var(--primary) 75%, var(--primary) 76%, transparent 77%, transparent); background-size: 50px 50px;"></div>
        </div>

        <!-- Taskbar -->
        <div class="absolute top-0 w-full h-12 bg-black/80 border-b flex items-center justify-between px-4 backdrop-blur z-50" style="border-color: rgba(255,255,255,0.1)">
            <div class="flex items-center gap-4">
                <i class="fas fa-shield-halved text-xl animate-pulse" style="color: var(--primary)"></i>
                <span class="font-mono text-sm tracking-widest text-gray-300">SYSTEM <span class="text-green-500">ONLINE</span></span>
                <!-- APPS DROPDOWN -->
                <div class="relative group">
                    <button class="cyber-btn px-2 py-1 text-[10px] uppercase border rounded hover:bg-white/10">
                        <i class="fas fa-th-large mr-1"></i> [ APPS ]
                    </button>
                    <div class="absolute top-full left-0 mt-1 w-48 bg-black border border-[var(--primary)] hidden group-hover:block shadow-[0_0_20px_var(--primary)] z-50 max-h-[80vh] overflow-y-auto scrollbar-thin">
                        <div class="px-2 py-1 text-[9px] text-gray-500 font-bold bg-gray-900">SYSTEM</div>
                        <div onclick="openWindow('win-settings')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-sliders mr-2"></i>ADMIN_PANEL</div>
                        <div class="px-2 py-1 text-[9px] text-gray-500 font-bold bg-gray-900">CRITICAL TOOLS</div>
                        <div onclick="openWindow('win-netmap')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-project-diagram mr-2"></i>NET_OVERWATCH</div>
                        <div onclick="openWindow('win-injector')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-code mr-2"></i>PAYLOAD_INJECTOR</div>
                        <div onclick="openWindow('win-brute')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-unlock-alt mr-2"></i>BRUTE_FORCE</div>
                        <div onclick="openWindow('win-sniffer')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-network-wired mr-2"></i>PACKET_STREAM</div>
                        <div onclick="openWindow('win-bio')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-heartbeat mr-2"></i>BIO_MONITOR</div>
                        <div class="px-2 py-1 text-[9px] text-gray-500 font-bold bg-gray-900">UTILITIES</div>
                        <div onclick="openWindow('win-signal')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-music mr-2"></i>SYSTEM_EQUALIZER</div>
                        <div onclick="openWindow('win-threat')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-globe mr-2"></i>GLOBAL_THREATS</div>
                        <div onclick="openWindow('win-orbital')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-satellite mr-2"></i>ORBITAL_UPLINK</div>
                        <div onclick="openWindow('win-hex')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono border-b border-gray-800"><i class="fas fa-microchip mr-2"></i>HEX_DUMP_VIEWER</div>
                        <div onclick="openWindow('win-miner')" class="px-4 py-2 hover:bg-[var(--primary)] hover:text-black cursor-pointer text-xs font-mono"><i class="fas fa-coins mr-2"></i>CRYPTO_MINER</div>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button onclick="toggleAmbience()" id="ambience-btn" class="cyber-btn px-2 py-1 text-[10px] uppercase border rounded taskbar-hide-mobile"><i class="fas fa-volume-off mr-1"></i> Audio</button>
                <div class="text-xs font-mono" style="color: var(--primary)" id="clock">00:00:00</div>
                <button onclick="logout()" class="text-red-500 hover:text-white border border-red-900 px-3 py-1 hover:bg-red-600 transition-colors uppercase text-[10px] tracking-wider">Logoff</button>
            </div>
        </div>

        <!-- WIN 1: SYS -->
        <div id="win-sys" class="window-panel" style="top: 80px; left: 30px;">
            <div id="win-sys-header" class="window-header"><span><i class="fas fa-server mr-2"></i>SYS_MONITOR</span><div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div></div>
            <div class="window-content font-mono text-xs text-gray-300">
                <div class="mb-4 flex items-center justify-between"><span>CPU_LOAD</span><div class="w-32 h-2 bg-gray-800 rounded-full overflow-hidden"><div class="h-full bg-current animate-[pulse_2s_infinite]" style="width: 45%; color: var(--primary)"></div></div></div>
                <div class="mb-4 flex items-center justify-between"><span>MEM_ALLOC</span><div class="w-32 h-2 bg-gray-800 rounded-full overflow-hidden"><div class="h-full bg-purple-500 animate-[pulse_3s_infinite]" style="width: 72%"></div></div></div>
                <div class="border-t border-gray-700 pt-2 mt-2"><p class="mb-1" style="color: var(--primary)">> Connecting to satellite...</p><p class="text-green-500 mb-1">> Connection established.</p><p class="text-gray-500">> Uplink secure.</p></div>
            </div>
        </div>

        <!-- WIN 2: FILES -->
        <div id="win-files" class="window-panel" style="top: 130px; left: 400px;">
            <div id="win-files-header" class="window-header"><span><i class="fas fa-folder-open mr-2"></i>DATA_VAULT</span><div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div></div>
            <div class="window-content"><div id="file-grid" class="grid grid-cols-3 gap-2"></div></div>
        </div>

        <!-- WIN 3: TERM -->
        <div id="win-term" class="window-panel w-full max-w-[500px]" style="top: 380px; left: 80px;">
            <div id="win-term-header" class="window-header bg-black/50"><span><i class="fas fa-terminal mr-2"></i>ROOT_TERMINAL</span><div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div></div>
            <div class="window-content bg-black/90 font-mono h-48 flex flex-col" onclick="document.getElementById('term-input').focus()">
                <div id="term-output" class="flex-1 terminal-text overflow-y-auto mb-2 scrollbar-thin"><div class="opacity-50">NEURAL_OS [Version 10.0]</div><div class="opacity-50">(c) CyberCorp. All rights reserved.</div><br><div style="color: var(--primary)">Type 'help' for available commands.</div></div>
                <div class="flex items-center text-lg relative w-full"><span class="mr-2 text-green-500 shrink-0">root@sys:~#</span><div class="relative w-full"><input type="text" id="term-ghost" class="absolute top-0 left-0 w-full bg-transparent border-none outline-none font-mono uppercase opacity-40 pointer-events-none select-none" disabled><input type="text" id="term-input" class="relative z-10 w-full bg-transparent border-none outline-none font-mono uppercase" style="color: var(--primary)" autocomplete="off"></div></div>
            </div>
        </div>

        <!-- WIN 4: DECRYPTION -->
        <div id="win-game" class="window-panel w-[300px]" style="top: 100px; left: 750px;">
             <div id="win-game-header" class="window-header"><span><i class="fas fa-lock-open mr-2"></i>DECRYPTION_PORTAL</span><div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div></div>
            <div class="window-content flex flex-col items-center p-6 gap-4 relative h-[280px]">
                <div id="portal-phase-1" class="w-full flex flex-col items-center gap-4 transition-all duration-500"><div class="text-center"><i class="fas fa-shield-cat text-4xl mb-2" style="color: var(--primary)"></i><p class="text-[10px] font-mono opacity-70">ENTER PORTAL ACCESS CODE</p><p class="text-[9px] text-gray-500">[ DEFAULT: 999 ]</p></div><input type="password" id="portal-input" class="bg-black border border-[var(--primary)] text-center text-xl font-mono py-2 w-full focus:outline-none shadow-[inset_0_0_10px_rgba(0,0,0,0.8)] placeholder-gray-800" placeholder="***" maxlength="10" autocomplete="off" style="color: var(--primary)"><button onclick="submitPortal()" id="portal-btn" class="scanner-btn cyber-btn w-full py-3 flex items-center justify-center gap-2 font-bold text-sm group"><i class="fas fa-fingerprint group-hover:scale-110 transition-transform"></i><span>SCAN IDENTITY</span></button><div id="portal-msg" class="text-xs font-bold h-4 text-center text-red-500 opacity-0 transition-opacity">INVALID CREDENTIALS</div></div>
                <div id="portal-phase-2" class="absolute inset-0 flex flex-col items-center justify-center bg-black/95 z-10 hidden-el opacity-0 transition-opacity duration-500"><p class="text-[10px] font-mono mb-6 text-center animate-pulse" style="color: var(--primary)">BIOMETRIC CONFIRMATION REQUIRED</p><div id="portal-bio-scanner" class="fingerprint-container scale-90" onmousedown="startPortalBio()" onmouseup="stopPortalBio()" onmouseleave="stopPortalBio()" ontouchstart="startPortalBio()" ontouchend="stopPortalBio()"><i class="fas fa-fingerprint fingerprint-icon"></i><div class="scan-beam"></div></div><div class="w-40 h-1 bg-gray-800 mt-6 rounded-full overflow-hidden"><div id="portal-bio-progress" class="h-full w-0 transition-all duration-100 ease-linear" style="background-color: var(--primary)"></div></div><p id="portal-status" class="text-xs font-bold mt-4 h-4 tracking-wider text-center"></p></div>
            </div>
        </div>

        <!-- WIN 5: AI CHAT -->
        <div id="win-ai" class="window-panel w-[350px] hidden-el" style="top: 150px; left: 150px; height: 400px; z-index: 55;">
            <div id="win-ai-header" class="window-header"><span><i class="fas fa-brain mr-2"></i>NEURAL_LINK // AI_CORE</span><div class="flex gap-1"><button onclick="closeAI()" class="text-[10px] hover:text-white px-2">X</button></div></div>
            <div class="window-content flex flex-col h-full p-0">
                <div id="ai-chat-display" class="flex-1 p-4 overflow-y-auto flex flex-col font-mono text-xs scrollbar-thin"></div>
                <div class="p-2 border-t border-[var(--primary)] bg-black/50 flex gap-2"><input type="text" id="ai-input" class="flex-1 bg-transparent border border-gray-800 text-[var(--primary)] text-xs p-2 focus:outline-none focus:border-[var(--primary)] font-mono placeholder-gray-700" placeholder="Enter query sequence..." autocomplete="off" onkeypress="if(event.key==='Enter') sendAIQuery()"><button onclick="sendAIQuery()" class="cyber-btn px-3 text-xs font-bold flex items-center justify-center"><i class="fas fa-paper-plane"></i></button></div>
            </div>
        </div>

        <!-- WIN 6: DESIGN LAB -->
        <div id="win-design" class="window-panel w-[280px]" style="top: 250px; left: 450px;">
            <div id="win-design-header" class="window-header"><span><i class="fas fa-pen-ruler mr-2"></i>PROTO_LAB</span><div class="flex gap-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div><div class="w-2 h-2 rounded-full bg-green-500"></div></div></div>
            <div class="window-content flex items-center justify-center bg-black/50 p-6">
                <div class="design-btn-wrapper"><div class="design-line horizontal top"></div><div class="design-line vertical right"></div><div class="design-line horizontal bottom"></div><div class="design-line vertical left"></div><div class="design-dot top left"></div><div class="design-dot top right"></div><div class="design-dot bottom right"></div><div class="design-dot bottom left"></div><button class="design-btn" onclick="toggleVaultLock()"><span class="btn-text">INITIATE</span><svg class="design-btn-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.6744 11.4075L15.7691 17.1233C15.7072 17.309 15.5586 17.4529 15.3709 17.5087L3.69348 20.9803C3.22819 21.1186 2.79978 20.676 2.95328 20.2155L6.74467 8.84131C6.79981 8.67588 6.92419 8.54263 7.08543 8.47624L12.472 6.25822C12.696 6.166 12.9535 6.21749 13.1248 6.38876L17.5294 10.7935C17.6901 10.9542 17.7463 11.1919 17.6744 11.4075Z"></path><path d="M3.2959 20.6016L9.65986 14.2376"></path><path d="M17.7917 11.0557L20.6202 8.22724C21.4012 7.44619 21.4012 6.17986 20.6202 5.39881L18.4989 3.27749C17.7178 2.49645 16.4515 2.49645 15.6704 3.27749L12.842 6.10592"></path><path d="M11.7814 12.1163C11.1956 11.5305 10.2458 11.5305 9.66004 12.1163C9.07426 12.7021 9.07426 13.6519 9.66004 14.2376C10.2458 14.8234 11.1956 14.8234 11.7814 14.2376C12.3671 13.6519 12.3671 12.7021 11.7814 12.1163Z"></path></svg></button></div>
            </div>
        </div>

        <!-- WIN 7: ADMIN PANEL -->
        <div id="win-settings" class="hidden-el window-panel w-[300px]" style="top: 200px; left: 600px;">
            <div id="win-settings-header" class="window-header"><span><i class="fas fa-sliders mr-2"></i>ADMIN_PANEL</span><button onclick="document.getElementById('win-settings').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black/90 p-4">
                <div class="mb-4"><label class="text-[10px] text-gray-500 font-mono block mb-2">SYSTEM HUE (COLOR)</label><input type="range" min="0" max="360" value="180" oninput="changeHue(this.value)" class="w-full accent-white h-2 bg-gradient-to-r from-red-500 via-green-500 to-blue-500 rounded-lg appearance-none cursor-pointer"></div>
                <div class="mb-4"><label class="text-[10px] text-gray-500 font-mono block mb-2">MATRIX RAIN</label><button onclick="toggleMatrix()" class="cyber-btn w-full py-1 text-xs">TOGGLE VISUALS</button></div>
                <div><label class="text-[10px] text-gray-500 font-mono block mb-2">SCANLINE INTENSITY</label><input type="range" min="0" max="100" value="15" oninput="changeScanline(this.value)" class="w-full accent-[var(--primary)] h-1 bg-gray-800 rounded-lg appearance-none cursor-pointer"></div>
            </div>
        </div>

        <!-- WIN 8: NET MAPPER -->
        <div id="win-netmap" class="hidden-el window-panel w-[400px] h-[300px]" style="top: 150px; left: 350px;">
            <div id="win-netmap-header" class="window-header"><span><i class="fas fa-project-diagram mr-2"></i>NET_OVERWATCH</span><button onclick="document.getElementById('win-netmap').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-0 relative overflow-hidden h-full flex flex-col"><div class="absolute top-2 left-2 text-[10px] text-[var(--primary)] bg-black/50 px-2 rounded font-mono z-10 pointer-events-none">TARGETS DETECTED: <span id="node-count">0</span></div><svg id="net-svg" class="w-full h-full" style="background: radial-gradient(circle at center, #111, #000);"></svg></div>
        </div>

        <!-- WIN 9: PAYLOAD INJECTOR -->
        <div id="win-injector" class="hidden-el window-panel w-[500px]" style="top: 300px; left: 200px;">
            <div id="win-injector-header" class="window-header"><span><i class="fas fa-code mr-2"></i>PAYLOAD_INJECTOR</span><button onclick="document.getElementById('win-injector').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-[#0a0a0a] flex flex-col h-[300px] p-0">
                <div class="bg-[#111] p-1 text-[10px] text-gray-500 flex justify-between px-2 font-mono"><span>/usr/bin/root/inject.cpp</span><span>MODE: INSERT</span></div><textarea id="hacker-input" class="flex-1 bg-transparent text-[var(--primary)] font-mono text-xs p-2 resize-none outline-none border-none" spellcheck="false" placeholder="Start typing to inject payload..."></textarea><div class="p-2 border-t border-gray-800 bg-black/50"><button onclick="deployPayload()" class="cyber-btn w-full py-2 text-xs font-bold tracking-widest hover:bg-green-500/20">DEPLOY PAYLOAD</button></div>
            </div>
        </div>

        <!-- WIN 10: SYSTEM EQUALIZER -->
        <div id="win-signal" class="hidden-el window-panel w-[400px] h-[200px]" style="top: 450px; left: 100px;">
            <div id="win-signal-header" class="window-header"><span><i class="fas fa-music mr-2"></i>SYSTEM_EQUALIZER</span><button onclick="document.getElementById('win-signal').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-0 relative h-full flex items-end justify-center gap-[2px] overflow-hidden" id="signal-container"></div>
        </div>

        <!-- WIN 11: GLOBAL THREAT MAP -->
        <div id="win-threat" class="hidden-el window-panel w-[500px] h-[300px]" style="top: 100px; left: 100px;">
            <div id="win-threat-header" class="window-header"><span><i class="fas fa-globe mr-2"></i>GLOBAL_THREATS</span><button onclick="document.getElementById('win-threat').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-0 relative h-full overflow-hidden" style="background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px;"><div class="absolute inset-0 opacity-20 pointer-events-none" style="background: url('https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.svg') no-repeat center center; background-size: contain; filter: invert(1) brightness(0.5);"></div><div id="threat-container" class="absolute inset-0"></div><div class="absolute bottom-2 left-2 text-[9px] font-mono text-[var(--primary)] bg-black/80 px-1">SCANNING GLOBAL NETWORKS...</div></div>
        </div>

        <!-- WIN 12: BRUTE FORCE -->
        <div id="win-brute" class="hidden-el window-panel w-[350px]" style="top: 400px; left: 500px;">
            <div id="win-brute-header" class="window-header"><span><i class="fas fa-unlock-alt mr-2"></i>BRUTE_FORCE_ENGINE</span><button onclick="document.getElementById('win-brute').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-4 flex flex-col gap-2 font-mono"><div class="text-[10px] text-gray-500">TARGET HASH: <span class="text-white">af89...22c1</span></div><div id="brute-log" class="h-32 overflow-hidden border border-gray-800 bg-black/50 p-2 text-xs text-gray-400"></div><button onclick="startBruteForce()" class="cyber-btn w-full py-1 text-xs">INITIATE ATTACK</button></div>
        </div>

        <!-- WIN 13: PACKET SNIFFER -->
        <div id="win-sniffer" class="hidden-el window-panel w-[400px]" style="top: 350px; left: 150px;">
            <div id="win-sniffer-header" class="window-header"><span><i class="fas fa-network-wired mr-2"></i>PACKET_STREAM</span><button onclick="document.getElementById('win-sniffer').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-0"><div id="sniffer-output" class="h-48 overflow-hidden font-mono text-[10px] p-2 text-green-500/80"></div></div>
        </div>

        <!-- WIN 14: BIO MONITOR -->
        <div id="win-bio" class="hidden-el window-panel w-[300px]" style="top: 150px; left: 800px;">
            <div id="win-bio-header" class="window-header"><span><i class="fas fa-heartbeat mr-2"></i>BIO_MONITOR</span><button onclick="document.getElementById('win-bio').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-4 flex flex-col items-center">
                <div class="relative w-32 h-32 mb-2"><svg class="w-full h-full animate-[spin_4s_linear_infinite]" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" stroke="var(--primary)" stroke-width="2" fill="none" stroke-dasharray="200" stroke-dashoffset="100"></circle></svg><div class="absolute inset-0 flex items-center justify-center text-xl font-bold text-[var(--primary)] animate-pulse">98%</div></div>
                <div class="text-xs text-gray-400">NEURAL SYNC RATE: STABLE</div><div class="w-full h-16 mt-2 bg-gray-900 border border-gray-800 overflow-hidden relative"><div id="heartbeat-line" class="absolute top-1/2 left-0 h-[2px] bg-red-500 w-full"></div></div>
            </div>
        </div>

        <!-- WIN 15: ORBITAL UPLINK -->
        <div id="win-orbital" class="hidden-el window-panel w-[300px] h-[300px]" style="top: 50px; left: 50px;">
            <div id="win-orbital-header" class="window-header"><span><i class="fas fa-satellite mr-2"></i>ORBITAL_UPLINK</span><button onclick="document.getElementById('win-orbital').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black flex items-center justify-center overflow-hidden"><div class="globe-container"><div class="globe"><div class="globe-ring"></div></div></div><div class="absolute bottom-2 text-[10px] text-[var(--primary)] font-mono">TRACKING: SAT_V9</div></div>
        </div>

        <!-- WIN 16: HEX DUMP VIEWER (New) -->
        <div id="win-hex" class="hidden-el window-panel w-[400px]" style="top: 300px; left: 600px;">
            <div id="win-hex-header" class="window-header"><span><i class="fas fa-microchip mr-2"></i>HEX_DUMP_VIEWER</span><button onclick="document.getElementById('win-hex').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-0 font-mono text-[10px] text-[#00ff00] h-[250px] overflow-hidden p-2" id="hex-container"></div>
        </div>

        <!-- WIN 17: CRYPTO MINER (New) -->
        <div id="win-miner" class="hidden-el window-panel w-[350px]" style="top: 100px; left: 800px;">
            <div id="win-miner-header" class="window-header"><span><i class="fas fa-coins mr-2"></i>CRYPTO_MINER</span><button onclick="document.getElementById('win-miner').classList.add('hidden-el')" class="text-xs hover:text-white">X</button></div>
            <div class="window-content bg-black p-4 font-mono text-xs">
                <div class="flex justify-between mb-2 text-gray-400"><span>HASH RATE:</span><span class="text-white" id="miner-hash">0.00 MH/s</span></div>
                <div class="flex justify-between mb-2 text-gray-400"><span>BLOCKS FOUND:</span><span class="text-[var(--primary)]" id="miner-blocks">0</span></div>
                <div class="flex justify-between mb-4 text-gray-400"><span>GPU TEMP:</span><span class="text-red-500" id="miner-temp">45Â°C</span></div>
                <div class="h-20 bg-gray-900 border border-gray-800 p-2 overflow-y-auto text-[9px] text-gray-500" id="miner-log"></div>
                <button onclick="toggleMining()" id="miner-btn" class="cyber-btn w-full py-1 mt-2 text-xs">START MINING</button>
            </div>
        </div>

    </div>

    <!-- BROWSER STAGE -->
    <div id="browser-stage" class="hidden-el window-panel flex flex-col transition-opacity duration-300" style="position: fixed; width: 100%; height: 100%; top: 0; left: 0; border: none; z-index: 10000;">
        <div id="browser-stage-header" class="window-header h-14 border-b border-[#00f3ff] bg-black/90 flex items-center px-4 gap-4 shadow-[0_0_20px_rgba(0,243,255,0.1)] relative z-20">
            <button onclick="closeBrowser()" class="cyber-btn h-8 w-8 flex items-center justify-center rounded hover:bg-[#00f3ff]/20 text-[#00f3ff] border border-[#00f3ff]">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="flex-1 bg-black border border-[#00f3ff]/30 rounded px-4 py-2 text-xs font-mono text-[#00f3ff] tracking-widest flex items-center gap-2 shadow-inner">
                <i class="fas fa-lock text-[10px]"></i>
                <span id="browser-url">SECURE_LINK::EXTERNAL_SOURCE</span>
            </div>
            <div class="flex gap-2"><div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div></div>
        </div>
        <div class="flex-1 w-full h-full relative bg-white">
            <div class="absolute inset-0 flex flex-col items-center justify-center bg-gray-900 text-[#00f3ff] z-0">
                <i class="fas fa-circle-notch fa-spin text-4xl mb-4"></i>
                <span class="font-mono text-xs tracking-widest">ESTABLISHING SECURE CONNECTION...</span>
            </div>
            <iframe id="browser-frame" class="w-full h-full border-none relative z-10" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals allow-popups-to-escape-sandbox allow-presentation" referrerpolicy="no-referrer" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>
        </div>
    </div>

    <!-- CONFIG MODAL -->
    <div id="password-modal" class="fixed inset-0 z-[60] bg-black/90 backdrop-blur-md flex items-center justify-center hidden-el">
        <div class="window-panel w-[350px] border border-[var(--primary)] shadow-[0_0_50px_rgba(0,243,255,0.2)] bg-black">
            <div class="window-header"><span><i class="fas fa-cogs mr-2"></i>ROOT_ACCESS_CONFIG</span><i class="fas fa-unlock text-green-500"></i></div>
            <div class="window-content flex flex-col gap-6 p-6">
                <div class="text-center border-b border-gray-800 pb-4"><h2 class="text-xl font-bold tracking-widest text-white">SYSTEM OVERRIDE</h2><p class="text-[10px] text-gray-500 mt-1">MODIFY SECURITY CREDENTIALS</p></div>
                <div class="space-y-4">
                    <div><label class="text-[10px] font-mono text-[var(--primary)] block mb-1">MAIN SYSTEM PIN</label><input type="text" id="edit-pin-input" class="w-full bg-gray-900 border border-gray-700 text-white text-center text-lg font-mono py-2 focus:outline-none focus:border-[var(--primary)]" maxlength="4"></div>
                    <div><label class="text-[10px] font-mono text-[var(--primary)] block mb-1">PORTAL ACCESS CODE</label><input type="text" id="edit-portal-input" class="w-full bg-gray-900 border border-gray-700 text-white text-center text-lg font-mono py-2 focus:outline-none focus:border-[var(--primary)]" maxlength="10"></div>
                    <div><label class="text-[10px] font-mono text-[var(--primary)] block mb-1">NEURAL LINK API KEY</label><input type="text" id="edit-api-key" class="w-full bg-gray-900 border border-gray-700 text-white text-center text-[10px] font-mono py-2 focus:outline-none focus:border-[var(--primary)]" placeholder="ENTER API KEY" autocomplete="off"></div>
                </div>
                <div class="flex gap-3 mt-2"><button onclick="saveConfig()" class="flex-1 cyber-btn py-3 text-xs font-bold hover:bg-[var(--primary)] hover:text-black">SAVE CHANGES</button><button onclick="closeConfigModal()" class="flex-1 border border-red-500 text-red-500 hover:bg-red-900/30 py-3 text-xs font-bold">EXIT & LOCK</button></div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBALS ---
        let systemPin = "340";
        let portalPin = "999";
        let apiKey = "AIzaSyATNNLhilXtGHripTrT13BBUwRablS5-cE";
        let vaultUnlocked = false;
        let matrixEnabled = true;
        let audioActivity = 0; 
        
        // Command Autocomplete Data
        const commands = [
            'clear', 'reboot', 'shut ai_core', 'shut sys_monitor', 'shut data_vault', 
            'shut proto_lab', 'shut decryption_portal', 'shut admin_panel', 
            'shut net_overwatch', 'shut payload_injector', 'shut signal_intercept', 'shut global_threats',
            'shut brute_force', 'shut packet_stream', 'shut bio_monitor', 'shut orbital_uplink',
            'shut hex_viewer', 'shut crypto_miner',
            'help'
        ];

        // Hacker Typer Snippets
        const codeSnippets = [
            "#include <iostream>\n#include <vector>\n\nusing namespace std;\n\nclass Payload {\npublic:\n    void execute() {\n        cout << 'Injecting...' << endl;\n    }\n};\n",
            "int main() {\n    Payload* p = new Payload();\n    p->execute();\n    return 0;\n}\n",
            "// Bypassing Firewall...\nif (securityLevel < 10) {\n    breachSystem();\n} else {\n    bruteForce(passwordHash);\n}\n",
            "void breachSystem() {\n    // Granting Root Access\n    system('sudo rm -rf /var/log');\n    connectToMainframe();\n}\n"
        ];
        let currentSnippetIndex = 0;
        let currentCharIndex = 0;

        const mockResponses = [
            "Analyzing sector 7... No anomalies detected.",
            "Neural link unstable. Rerouting through local proxy.",
            "I am currently operating in offline simulation mode.",
            "Access to global mainframe restricted. Using local cache.",
            "Encrypted packet received. Decryption in progress...",
            "System check complete. All subsystems nominal.",
            "Searching local database... 0 matches found."
        ];
        
        let files = [
            { icon: 'fa-file-pdf', color: 'text-red-400', name: 'PLANS_V2.pdf' },
            { icon: 'fa-file-image', color: 'text-purple-400', name: 'EVIDENCE.jpg' },
            { icon: 'fa-file-code', color: 'text-yellow-400', name: 'VIRUS.exe' },
            { icon: 'fa-database', color: 'text-green-400', name: 'users.db' },
            { icon: 'fa-database', color: 'text-orange-400', name: 'img.db' },
            { icon: 'fa-address-book', color: 'text-blue-400', name: 'call.db' },
            { icon: 'fa-brain', color: 'text-pink-400', name: 'AI_CORE.exe' }
        ];

        // --- AUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let ambienceOsc = null;
        let ambienceGain = null;

        function playBeep(freq = 800, type = 'sine', duration = 0.05, vol = 0.1) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
            audioActivity = 1.0; 
        }

        function toggleAmbience() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const btn = document.getElementById('ambience-btn');
            if (ambienceOsc) {
                ambienceGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1);
                ambienceOsc.stop(audioCtx.currentTime + 1); ambienceOsc = null;
                btn.innerHTML = '<i class="fas fa-volume-off mr-1"></i> Audio'; btn.classList.remove('bg-white/20');
            } else {
                ambienceOsc = audioCtx.createOscillator(); ambienceGain = audioCtx.createGain();
                ambienceOsc.type = 'sawtooth'; ambienceOsc.frequency.setValueAtTime(50, audioCtx.currentTime);
                const filter = audioCtx.createBiquadFilter(); filter.type = 'lowpass'; filter.frequency.value = 200;
                ambienceGain.gain.setValueAtTime(0, audioCtx.currentTime);
                ambienceGain.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 2);
                ambienceOsc.connect(filter); filter.connect(ambienceGain); ambienceGain.connect(audioCtx.destination);
                ambienceOsc.start();
                btn.innerHTML = '<i class="fas fa-volume-up mr-1"></i> Audio'; btn.classList.add('bg-white/20');
            }
        }

        function playError() { playBeep(150, 'sawtooth', 0.3); setTimeout(() => playBeep(100, 'sawtooth', 0.3), 150); }
        function playSuccess() { playBeep(1200, 'sine', 0.1); setTimeout(() => playBeep(1800, 'square', 0.2), 100); }

        // --- BOOT ---
        const bootLines = ["NEURAL BIOS v10.0 - (c) 2100 CyberCorp", "Checking Hardware... OK", "Loading Kernel... OK", "Mounting /dev/brain0... OK", "Scanning Peripherals...", "Booting System..."];
        async function runBoot() {
            const screen = document.getElementById('boot-screen');
            for(let line of bootLines) {
                const div = document.createElement('div'); div.className = 'boot-line'; div.innerHTML = `> ${line}`;
                screen.appendChild(div); playBeep(800, 'square', 0.01, 0.02);
                await new Promise(r => setTimeout(r, Math.random() * 200 + 50));
            }
            await new Promise(r => setTimeout(r, 600));
            screen.style.opacity = '0';
            setTimeout(() => { 
                screen.classList.add('hidden-el'); 
                document.getElementById('login-stage').classList.remove('hidden-el');
                initAdaptiveAuth(); 
            }, 500);
        }
        window.onload = runBoot;

        // --- ADAPTIVE AUTH ---
        let webcamStream = null;
        async function initAdaptiveAuth() {
            const bioText = document.getElementById('bio-text');
            const bioWrapper = document.getElementById('fingerprint-wrapper');
            const faceContainer = document.getElementById('face-feed-container');
            bioText.innerText = "CHECKING CAMERA HARDWARE...";
            try {
                webcamStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                const videoEl = document.getElementById('webcam-video');
                videoEl.srcObject = webcamStream;
                bioWrapper.classList.add('hidden-el');
                faceContainer.style.display = 'block'; 
                bioText.innerText = "FACE ID: ANALYZING...";
                bioText.classList.remove('animate-pulse');
                startFaceScanLogic();
            } catch (err) {
                forceFingerprintMode();
            }
        }
        function forceFingerprintMode() {
            if(webcamStream) { webcamStream.getTracks().forEach(track => track.stop()); }
            document.getElementById('face-feed-container').style.display = 'none';
            document.getElementById('fingerprint-wrapper').classList.remove('hidden-el');
            document.getElementById('manual-fallback-btn').classList.add('hidden-el');
            const bioText = document.getElementById('bio-text');
            bioText.innerText = "HOLD TO SCAN BIOMETRICS";
            bioText.classList.add('animate-pulse');
        }
        function startFaceScanLogic() {
            const bioProgress = document.getElementById('bio-progress');
            const bioText = document.getElementById('bio-text');
            let progress = 0;
            playBeep(400, 'square', 0.2); 
            const faceInterval = setInterval(() => {
                progress += 1;
                bioProgress.style.width = progress + '%';
                if(progress % 20 === 0) playBeep(1000 + progress*5, 'sine', 0.05);
                if (progress >= 100) {
                    clearInterval(faceInterval);
                    bioText.innerText = "IDENTITY VERIFIED";
                    bioText.style.color = "#0f0";
                    playSuccess();
                    setTimeout(completeScan, 800);
                }
            }, 30); 
        }

        // --- MATRIX ---
        const canvas = document.getElementById('matrix-canvas'), ctx = canvas.getContext('2d');
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas); resizeCanvas();
        const alphabet = '01XY'.split('');
        const fontSize = 14;
        let columns = canvas.width/fontSize, rainDrops = Array(Math.floor(columns)).fill(1);
        window.addEventListener('resize', () => { columns = canvas.width/fontSize; rainDrops = Array(Math.floor(columns)).fill(1); });
        function drawMatrix() {
            if(!matrixEnabled) { ctx.clearRect(0,0,canvas.width, canvas.height); return; }
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)'; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--primary').trim();
            ctx.font = fontSize + 'px monospace';
            for(let i = 0; i < rainDrops.length; i++) {
                const text = alphabet[Math.floor(Math.random() * alphabet.length)];
                ctx.fillText(text, i*fontSize, rainDrops[i]*fontSize);
                if(rainDrops[i]*fontSize > canvas.height && Math.random() > 0.975) rainDrops[i] = 0;
                rainDrops[i]++;
            }
        }
        setInterval(drawMatrix, 50);

        // --- FINGERPRINT ---
        let scanInterval, progress = 0;
        const bioScanner = document.getElementById('bio-scanner'), bioProgress = document.getElementById('bio-progress'), bioText = document.getElementById('bio-text');
        const bioPhase = document.getElementById('bio-phase'), pinPhase = document.getElementById('pin-phase');
        function startScan() {
            bioScanner.classList.add('scanning'); playBeep(200, 'sine', 2);
            bioText.innerText = "SCANNING..."; bioText.classList.remove('animate-pulse');
            scanInterval = setInterval(() => {
                progress += 2; bioProgress.style.width = progress + '%'; playBeep(200 + progress * 10, 'sine', 0.05);
                if (progress >= 100) { clearInterval(scanInterval); completeScan(); }
            }, 30);
        }
        function stopScan() {
            clearInterval(scanInterval);
            if (progress < 100) {
                progress = 0; bioProgress.style.width = '0%'; bioScanner.classList.remove('scanning');
                bioText.innerText = "HOLD TO SCAN BIOMETRICS"; bioText.classList.add('animate-pulse');
            }
        }
        function completeScan() {
             if(webcamStream) { webcamStream.getTracks().forEach(track => track.stop()); }
            playSuccess(); 
            document.getElementById('bio-text').innerText = "IDENTITY VERIFIED";
            setTimeout(() => { bioPhase.classList.add('hidden-el'); pinPhase.classList.remove('hidden-el'); }, 800);
        }

        // --- PIN ---
        let currentPin = "";
        const pinDisplay = document.getElementById('pin-display'), pinMsg = document.getElementById('pin-msg');
        function updatePinDisplay() { pinDisplay.innerText = 'â'.repeat(currentPin.length); }
        function pressKey(num) { if (currentPin.length < 4) { currentPin += num; updatePinDisplay(); pinMsg.style.opacity = '0'; playBeep(600 + (num * 50)); } }
        function clearPin() { currentPin = ""; updatePinDisplay(); pinMsg.style.opacity = '0'; playBeep(300); }
        function submitPin() {
            if (currentPin === systemPin || currentPin === "1234") {
                playSuccess(); pinDisplay.style.color = '#0f0'; setTimeout(unlockSystem, 500);
            } else {
                playError(); pinMsg.style.opacity = '1'; currentPin = ""; updatePinDisplay();
                document.getElementById('login-panel').animate([{ transform: 'translateX(-5px)' }, { transform: 'translateX(5px)' }, { transform: 'translateX(0)' }], { duration: 200 });
            }
        }
        function unlockSystem() {
            document.getElementById('login-stage').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-stage').classList.add('hidden-el');
                const dash = document.getElementById('dashboard-stage');
                dash.classList.remove('hidden-el');
                requestAnimationFrame(() => dash.style.opacity = '1');
                startClock(); renderFiles();
                
                // Start background logs
                startSystemLog();
            }, 500);
        }

        // --- BROWSER ---
        function openBrowser(url) {
            const browser = document.getElementById('browser-stage'), frame = document.getElementById('browser-frame');
            frame.src = url; 
            browser.classList.remove('hidden-el');
            browser.style.opacity = '0'; browser.style.transform = 'scale(0.95)';
            void browser.offsetWidth;
            browser.style.transition = 'all 0.3s ease-out'; browser.style.opacity = '1'; browser.style.transform = 'scale(1)';
        }
        function closeBrowser() {
            const browser = document.getElementById('browser-stage'), frame = document.getElementById('browser-frame');
            browser.style.opacity = '0'; browser.style.transform = 'scale(0.95)';
            setTimeout(() => { browser.classList.add('hidden-el'); frame.src = ''; document.getElementById('win-game').classList.remove('hidden-el'); }, 300);
        }
        
        // --- FILE HANDLING ---
        function handleFileClick(file) {
            if (!vaultUnlocked) { playError(); printToTerm("> ERROR: DATA_VAULT ENCRYPTION ACTIVE. UNLOCK REQUIRED.", "text-red-500"); return; }
            if (file.name === 'users.db') { playBeep(1200, 'sine', 0.1); openBrowser('https://mvs-img.vercel.app/'); }
            else if (file.name === 'img.db') { playBeep(1200, 'sine', 0.1); openBrowser('https://mvs-img.vercel.app/'); }
            else if (file.name === 'call.db') { playBeep(1200, 'sine', 0.1); document.getElementById('win-game').classList.add('hidden-el'); openBrowser('https://e8d07d6a0e1b5b4dc6f98d79f20e4c1e9f5.vercel.app/'); }
            else if (file.name === 'SECRET_PAYLOAD.script') { playBeep(1200, 'sine', 0.1); openConfigModal(); }
            else if (file.name === 'AI_CORE.exe') { playBeep(1200, 'sine', 0.1); openAIWindow(); }
            else { playError(); const term = document.getElementById('term-output'); const div = document.createElement('div'); div.className = 'text-red-500'; div.innerText = `> ERROR: File '${file.name}' is encrypted. Key missing.`; if(term) { term.appendChild(div); term.scrollTop = term.scrollHeight; } }
        }
        
        function renderFiles() {
            const container = document.getElementById('file-grid'); container.innerHTML = '';
            files.forEach((f, index) => {
                const div = document.createElement('div'); 
                div.className = 'group flex flex-col items-center p-2 hover:bg-white/5 cursor-pointer rounded transition-all file-item';
                div.style.animationDelay = `${index * 80}ms`; // Staggered delay
                div.onclick = () => handleFileClick(f);
                div.innerHTML = `<i class="fas ${f.icon} text-3xl ${f.color} mb-1 group-hover:scale-110 transition-transform"></i><span class="text-[9px] font-mono opacity-70 group-hover:opacity-100">${f.name}</span>`;
                container.appendChild(div);
            });
        }
        
        function toggleVaultLock() {
            vaultUnlocked = !vaultUnlocked;
            const btn = document.querySelector('.design-btn');
            const btnText = btn.querySelector('.btn-text');
            const win = document.getElementById('win-files');
            if (vaultUnlocked) {
                playSuccess(); btn.style.backgroundColor = '#00ff00'; btn.style.color = '#000'; btn.style.boxShadow = '0 0 20px #00ff00'; btnText.innerText = "SYSTEM ACTIVE"; win.style.borderColor = '#00ff00'; win.style.boxShadow = '0 0 20px rgba(0, 255, 0, 0.2)'; printToTerm("> PROTO_LAB: DATA_VAULT DECRYPTED.", "text-green-500");
            } else {
                playBeep(500, 'sawtooth', 0.2); btn.style.backgroundColor = ''; btn.style.color = ''; btn.style.boxShadow = ''; btnText.innerText = "INITIATE"; win.style.borderColor = ''; win.style.boxShadow = ''; printToTerm("> PROTO_LAB: DATA_VAULT ENCRYPTED.", "text-red-500");
            }
            renderFiles();
        }

        // --- DECRYPTION PORTAL ---
        let portalScanInterval, portalProgress = 0;
        function submitPortal() {
            const input = document.getElementById('portal-input');
            const val = input.value.trim();
            if (val === portalPin) {
                document.getElementById('portal-msg').style.opacity = '0';
                document.getElementById('portal-phase-1').style.opacity = '0';
                document.getElementById('portal-phase-1').style.pointerEvents = 'none';
                playSuccess();
                setTimeout(() => { document.getElementById('portal-phase-1').classList.add('hidden-el'); document.getElementById('portal-phase-2').classList.remove('hidden-el'); void document.getElementById('portal-phase-2').offsetWidth; document.getElementById('portal-phase-2').style.opacity = '1'; }, 300);
            } else {
                playError(); document.getElementById('portal-msg').style.opacity = '1'; input.value = ""; input.focus(); setTimeout(() => document.getElementById('portal-msg').style.opacity = '0', 2000);
            }
        }
        function startPortalBio() {
            const bar = document.getElementById('portal-bio-progress');
            document.getElementById('portal-bio-scanner').classList.add('scanning');
            playBeep(400, 'square', 2, 0.05);
            document.getElementById('portal-status').innerText = "VERIFYING BIOMETRICS...";
            document.getElementById('portal-status').style.color = "var(--primary)";
            portalScanInterval = setInterval(() => {
                portalProgress += 4; bar.style.width = portalProgress + '%'; playBeep(400 + (portalProgress * 5), 'sawtooth', 0.05, 0.05);
                if (portalProgress >= 100) { clearInterval(portalScanInterval); completePortalSuccess(); }
            }, 50);
        }
        function stopPortalBio() {
            clearInterval(portalScanInterval);
            if (portalProgress < 100) {
                portalProgress = 0; document.getElementById('portal-bio-progress').style.width = '0%'; document.getElementById('portal-bio-scanner').classList.remove('scanning'); document.getElementById('portal-status').innerText = "ALIGNMENT FAILED. RETRY."; document.getElementById('portal-status').style.color = "red"; playError();
            }
        }
        function completePortalSuccess() {
            playSuccess(); document.getElementById('portal-status').innerText = "IDENTITY CONFIRMED."; document.getElementById('portal-status').style.color = "#0f0";
            setTimeout(() => {
                if(!files.find(f => f.name === 'SECRET_PAYLOAD.script')) {
                    files.push({ icon: 'fa-file-code', color: 'text-red-500', name: 'SECRET_PAYLOAD.script' }); renderFiles(); printToTerm("> PORTAL BREACHED. PAYLOAD ACQUIRED.", "text-green-500");
                }
            }, 500);
        }

        // --- CONFIG MODAL ---
        function openConfigModal() {
            document.getElementById('win-game').classList.add('hidden-el');
            const modal = document.getElementById('password-modal');
            document.getElementById('edit-pin-input').value = systemPin;
            document.getElementById('edit-portal-input').value = portalPin;
            document.getElementById('edit-api-key').value = apiKey;
            modal.classList.remove('hidden-el'); void modal.offsetWidth; modal.classList.add('modal-visible');
        }
        function saveConfig() {
            const newPin = document.getElementById('edit-pin-input').value.trim();
            const newPort = document.getElementById('edit-portal-input').value.trim();
            const newApi = document.getElementById('edit-api-key').value.trim();
            if(newPin.length > 0 && newPin.length <= 4 && !isNaN(newPin)) systemPin = newPin;
            if(newPort.length > 0) portalPin = newPort;
            if(newApi !== apiKey) apiKey = newApi;
            playSuccess();
            printToTerm("> CONFIG UPDATE: CREDENTIALS MODIFIED.", "text-yellow-400");
            const btn = event.target; const oldText = btn.innerText; btn.innerText = "SAVED!"; setTimeout(() => btn.innerText = oldText, 1000);
        }
        function closeConfigModal() {
            const modal = document.getElementById('password-modal'); modal.classList.remove('modal-visible');
            setTimeout(() => {
                modal.classList.add('hidden-el'); document.getElementById('win-game').classList.remove('hidden-el'); playBeep(600, 'sawtooth', 0.2);
                files = files.filter(f => f.name !== 'SECRET_PAYLOAD.script'); renderFiles();
                document.getElementById('portal-phase-2').style.opacity = '0'; document.getElementById('portal-phase-2').classList.add('hidden-el');
                document.getElementById('portal-phase-1').classList.remove('hidden-el'); document.getElementById('portal-phase-1').style.pointerEvents = 'auto'; void document.getElementById('portal-phase-1').offsetWidth; document.getElementById('portal-phase-1').style.opacity = '1';
                document.getElementById('portal-input').value = ""; portalProgress = 0; document.getElementById('portal-bio-progress').style.width = '0%'; document.getElementById('portal-status').innerText = "";
                printToTerm("> SECURE SESSION CLOSED. TEMP FILES REMOVED.");
            }, 300);
        }

        // --- DRAG ---
        function makeDraggable(elmnt) {
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; const header = document.getElementById(elmnt.id + "-header");
            if (header) header.onmousedown = (e) => {
                e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY;
                document.querySelectorAll('.window-panel').forEach(w => w.style.zIndex = 10); elmnt.style.zIndex = 50;
                document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
                document.onmousemove = (e) => {
                    e.preventDefault(); pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY; pos3 = e.clientX; pos4 = e.clientY;
                    elmnt.style.top = (elmnt.offsetTop - pos2) + "px"; elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
                };
            };
        }
        makeDraggable(document.getElementById("win-sys")); makeDraggable(document.getElementById("win-files"));
        makeDraggable(document.getElementById("win-term")); makeDraggable(document.getElementById("win-game"));
        makeDraggable(document.getElementById("win-ai")); makeDraggable(document.getElementById("win-design"));
        makeDraggable(document.getElementById("win-settings")); makeDraggable(document.getElementById("win-netmap"));
        makeDraggable(document.getElementById("win-injector")); makeDraggable(document.getElementById("win-signal")); makeDraggable(document.getElementById("win-threat"));
        makeDraggable(document.getElementById("win-brute")); makeDraggable(document.getElementById("win-sniffer")); makeDraggable(document.getElementById("win-bio")); makeDraggable(document.getElementById("win-orbital"));
        makeDraggable(document.getElementById("win-hex")); makeDraggable(document.getElementById("win-miner"));

        // --- TERMINAL ---
        const termInput = document.getElementById('term-input'), termOutput = document.getElementById('term-output'), termGhost = document.getElementById('term-ghost');
        termInput.addEventListener('input', function(e) {
            const val = this.value.toLowerCase(); termGhost.value = "";
            if (val.length > 0) { const match = commands.find(cmd => cmd.startsWith(val)); if (match) termGhost.value = match; }
        });
        termInput.addEventListener('keydown', function(e) {
            if (e.key === 'Tab') { e.preventDefault(); if (termGhost.value !== "") { this.value = termGhost.value; termGhost.value = ""; } }
            else if (e.key === 'Enter') {
                const val = this.value.trim().toLowerCase(); playBeep(500); printToTerm(`root@sys:~# ${this.value}`, 'text-green-500'); termGhost.value = "";
                const parts = val.split(' '); const cmd = parts[0]; const arg = parts[1];
                if (cmd === 'shut') {
                    const map = {'ai_core':'win-ai', 'sys_monitor':'win-sys', 'data_vault':'win-files', 'proto_lab':'win-design', 'decryption_portal':'win-game', 'admin_panel':'win-settings', 'net_overwatch':'win-netmap', 'payload_injector':'win-injector', 'signal_intercept':'win-signal', 'global_threats':'win-threat', 'brute_force':'win-brute', 'packet_stream':'win-sniffer', 'bio_monitor':'win-bio', 'orbital_uplink':'win-orbital', 'hex_viewer':'win-hex', 'crypto_miner':'win-miner'};
                    const targetId = map[arg];
                    if (targetId) { document.getElementById(targetId).classList.add('hidden-el'); printToTerm(`> PROCESS ${arg.toUpperCase()} TERMINATED.`, "text-orange-500"); playBeep(300, 'sawtooth', 0.2); }
                    else printToTerm("> ERROR: UNKNOWN TARGET.", "text-red-500");
                } else if (val === 'clear') termOutput.innerHTML = '';
                else if (val === 'reboot') location.reload();
                else if (val === 'help') printToTerm("AVAILABLE COMMANDS: shut [target], clear, reboot", "text-yellow-400");
                else if (val !== '') printToTerm(`Error: ${val} not found`, 'text-red-500');
                this.value = ''; termOutput.scrollTop = termOutput.scrollHeight;
            }
        });
        function printToTerm(text, className = '') { const div = document.createElement('div'); div.className = className; div.innerText = text; termOutput.appendChild(div); }
        
        function startClock() { setInterval(() => { document.getElementById('clock').innerText = new Date().toISOString().split('T')[1].split('.')[0]; }, 1000); }
        function logout() { location.reload(); }

        // --- AI ---
        function openAIWindow() {
            const aiWin = document.getElementById('win-ai'); aiWin.classList.remove('hidden-el'); aiWin.style.zIndex = 60; setTimeout(() => document.getElementById('ai-input').focus(), 100);
            const display = document.getElementById('ai-chat-display');
            if(display.innerHTML.includes("Awaiting input")) { if (!apiKey) addMessageToChat('SYS', 'STATUS: OFFLINE MODE (SIMULATION ACTIVE)'); else addMessageToChat('SYS', 'STATUS: ONLINE (NEURAL LINK ESTABLISHED)'); }
        }
        function closeAI() { document.getElementById('win-ai').classList.add('hidden-el'); }
        async function sendAIQuery() {
            const input = document.getElementById('ai-input'); const text = input.value.trim(); if (!text) return;
            addMessageToChat('USER', text); input.value = '';
            const loadingId = 'loading-' + Date.now(); const loadingDiv = document.createElement('div'); loadingDiv.id = loadingId; loadingDiv.className = 'msg-bubble msg-ai'; loadingDiv.innerHTML = '<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>'; document.getElementById('ai-chat-display').appendChild(loadingDiv);
            if (!apiKey) { setTimeout(() => { document.getElementById(loadingId).remove(); let mockReply = mockResponses[Math.floor(Math.random() * mockResponses.length)]; if (text.toLowerCase().includes('code')) mockReply = "function neuralLink() {\n  return 'ACTIVE';\n}"; addMessageToChat('AI', `[SIMULATION] ${mockReply}`); }, 800); return; }
            try { const responseText = await generateGeminiContent(text); document.getElementById(loadingId).remove(); addMessageToChat('AI', responseText); } catch (error) { document.getElementById(loadingId).remove(); addMessageToChat('SYS', 'CONNECTION ERROR.'); }
        }
        function addMessageToChat(sender, text) {
            const display = document.getElementById('ai-chat-display'); const div = document.createElement('div');
            div.className = `msg-bubble ${sender === 'USER' ? 'msg-user' : 'msg-ai'} status-animate relative group flex flex-col`;
            const contentSpan = document.createElement('span'); contentSpan.innerText = text; div.appendChild(contentSpan);
            if (sender !== 'USER') {
                const copyBtn = document.createElement('button'); copyBtn.innerHTML = '<i class="fas fa-copy"></i>'; copyBtn.className = 'absolute top-1 right-1 text-[10px] text-white/50 hover:text-white bg-black/20 hover:bg-black/80 px-1.5 py-0.5 rounded';
                copyBtn.onclick = function(e) { e.stopPropagation(); navigator.clipboard.writeText(text); printToTerm("> COPIED TO CLIPBOARD", "text-green-500"); playBeep(1200, 'sine', 0.1); }; div.appendChild(copyBtn);
            }
            display.appendChild(div); display.scrollTop = display.scrollHeight; playBeep(800, 'sine', 0.05, 0.05);
        }
        async function generateGeminiContent(prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json(); return data.candidates?.[0]?.content?.parts?.[0]?.text || "NO DATA.";
        }

        // --- HELPERS ---
        function openWindow(id) {
            const win = document.getElementById(id); 
            if(win) { 
                win.classList.remove('hidden-el'); 
                document.querySelectorAll('.window-panel').forEach(w => w.style.zIndex = 10); 
                win.style.zIndex = 60; 
                if (id === 'win-netmap') startNetMap(); 
                if(id === 'win-signal') startSignalVis(); 
                if(id === 'win-threat') startThreatMap(); 
                if(id === 'win-sniffer') startSniffer();
                if(id === 'win-bio') startBioMonitor();
                if(id === 'win-hex') startHexDump();
            }
        }
        function changeHue(val) { document.documentElement.style.setProperty('--primary-hue', val); }
        function changeScanline(val) { document.documentElement.style.setProperty('--scanline-opacity', val / 100); }
        function toggleMatrix() { matrixEnabled = !matrixEnabled; printToTerm(`> MATRIX VISUALS: ${matrixEnabled ? 'ON' : 'OFF'}`, "text-blue-400"); }

        // --- NEW TOOLS LOGIC ---
        document.getElementById('hacker-input').addEventListener('keydown', function(e) {
            e.preventDefault(); playBeep(800 + Math.random()*200, 'square', 0.03, 0.05);
            const txt = codeSnippets[currentSnippetIndex]; this.value += txt.substring(currentCharIndex, currentCharIndex + 3); currentCharIndex += 3;
            if (currentCharIndex >= txt.length) { this.value += "\n\n"; currentSnippetIndex = (currentSnippetIndex + 1) % codeSnippets.length; currentCharIndex = 0; }
            this.scrollTop = this.scrollHeight;
        });
        function deployPayload() {
            const btn = event.target; btn.innerText = "EXECUTING..."; btn.classList.add('animate-pulse');
            setTimeout(() => { playSuccess(); btn.innerText = "ACCESS GRANTED"; btn.classList.remove('animate-pulse'); btn.classList.add('text-green-500'); printToTerm("> PAYLOAD INJECTION SUCCESSFUL.", "text-green-500"); setTimeout(() => { btn.innerText = "DEPLOY PAYLOAD"; btn.classList.remove('text-green-500'); }, 2000); }, 1500);
        }
        function startNetMap() {
            const c = document.getElementById('net-svg'); while (c.firstChild) c.removeChild(c.firstChild);
            const nodes = []; const count = Math.floor(Math.random() * 5) + 5; document.getElementById('node-count').innerText = count;
            for(let i=0; i<count; i++) {
                const cx = Math.random() * 300 + 50, cy = Math.random() * 200 + 50; nodes.push({x: cx, y: cy});
                if (i > 0) { const line = document.createElementNS("http://www.w3.org/2000/svg", "line"); line.setAttribute("x1", nodes[i-1].x); line.setAttribute("y1", nodes[i-1].y); line.setAttribute("x2", cx); line.setAttribute("y2", cy); line.setAttribute("stroke", "rgba(255,255,255,0.2)"); c.appendChild(line); }
                const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle"); circle.setAttribute("cx", cx); circle.setAttribute("cy", cy); circle.setAttribute("r", "5"); circle.setAttribute("fill", "red"); circle.setAttribute("class", "net-node");
                circle.onclick = function() { if (this.getAttribute("fill") === "red") { this.setAttribute("fill", "#00ff00"); playSuccess(); printToTerm(`> NODE_${i} BREACHED.`, "text-green-500"); } }; c.appendChild(circle);
            }
        }
        
        let signalInterval;
        function startSignalVis() {
            clearInterval(signalInterval);
            const c = document.getElementById('signal-container'); c.innerHTML = '';
            const bars = [];
            for(let i=0; i<40; i++) { const d = document.createElement('div'); d.className = 'signal-bar'; d.style.height = '5%'; c.appendChild(d); bars.push(d); }
            signalInterval = setInterval(() => {
                if(audioActivity > 0) audioActivity -= 0.05; if(audioActivity < 0) audioActivity = 0;
                bars.forEach((b, i) => { const noise = Math.random() * 20; const reaction = audioActivity * (Math.random() * 80); b.style.height = Math.max(5, noise + reaction) + '%'; });
            }, 50);
        }

        let threatInterval;
        function startThreatMap() {
            clearInterval(threatInterval);
            const c = document.getElementById('threat-container');
            threatInterval = setInterval(() => {
                const dot = document.createElement('div'); dot.className = 'threat-dot';
                dot.style.left = Math.random() * 100 + '%'; dot.style.top = Math.random() * 100 + '%';
                c.appendChild(dot); setTimeout(() => dot.remove(), 2000);
            }, 500);
        }

        let snifferInterval;
        function startSniffer() {
            clearInterval(snifferInterval);
            const out = document.getElementById('sniffer-output');
            snifferInterval = setInterval(() => {
                const ip = `${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`;
                const hex = Array(4).fill(0).map(() => Math.floor(Math.random()*65535).toString(16)).join(' ');
                const div = document.createElement('div'); div.innerText = `[${ip}] < ${hex} > INCOMING`; out.appendChild(div);
                if(out.children.length > 15) out.removeChild(out.firstChild); out.scrollTop = out.scrollHeight;
            }, 100);
        }

        let bruteInterval;
        function startBruteForce() {
            const log = document.getElementById('brute-log'); clearInterval(bruteInterval); log.innerHTML = ""; let attempts = 0;
            bruteInterval = setInterval(() => {
                attempts++; const hash = Math.random().toString(36).substring(2, 15);
                const div = document.createElement('div'); div.className = "hash-row"; div.innerText = `TRY ${attempts}: ${hash}... FAIL`; log.appendChild(div); log.scrollTop = log.scrollHeight;
                if(attempts > 50) { clearInterval(bruteInterval); const successDiv = document.createElement('div'); successDiv.className = "hash-row text-green-500 font-bold"; successDiv.innerText = "MATCH FOUND: PASSWORD123"; log.appendChild(successDiv); log.scrollTop = log.scrollHeight; playSuccess(); }
            }, 50);
        }

        let bioInterval;
        function startBioMonitor() { clearInterval(bioInterval); } // CSS handles viz

        // --- HEX DUMP ---
        let hexInterval;
        function startHexDump() {
            clearInterval(hexInterval);
            const container = document.getElementById('hex-container');
            hexInterval = setInterval(() => {
                const row = document.createElement('div');
                let hexStr = "";
                for(let i=0; i<8; i++) hexStr += Math.floor(Math.random()*255).toString(16).padStart(2,'0').toUpperCase() + " ";
                row.innerText = `0x${Math.floor(Math.random()*10000)}: ${hexStr}`;
                container.appendChild(row);
                if(container.children.length > 20) container.removeChild(container.firstChild);
                container.scrollTop = container.scrollHeight;
            }, 100);
        }

        // --- CRYPTO MINER ---
        let mineInterval, blocks = 0, hashRate = 0;
        let isMining = false;
        function toggleMining() {
            const btn = document.getElementById('miner-btn');
            const log = document.getElementById('miner-log');
            if(isMining) {
                isMining = false; clearInterval(mineInterval);
                btn.innerText = "START MINING"; btn.classList.remove('text-red-500');
                return;
            }
            isMining = true;
            btn.innerText = "STOP MINING"; btn.classList.add('text-red-500');
            mineInterval = setInterval(() => {
                hashRate = (Math.random() * 50 + 80).toFixed(2);
                document.getElementById('miner-hash').innerText = hashRate + " MH/s";
                document.getElementById('miner-temp').innerText = Math.floor(Math.random() * 20 + 60) + "Â°C";
                
                if(Math.random() > 0.95) {
                    blocks++;
                    document.getElementById('miner-blocks').innerText = blocks;
                    const div = document.createElement('div');
                    div.className = 'text-green-500';
                    div.innerText = `[${new Date().toLocaleTimeString()}] BLOCK FOUND! REWARD: 0.004 ETH`;
                    log.appendChild(div);
                    log.scrollTop = log.scrollHeight;
                    playBeep(1200, 'sine', 0.1);
                }
            }, 500);
        }

        // --- BACKGROUND LOG ---
        function startSystemLog() {
            const log = document.getElementById('system-log-bg');
            const msgs = ["PACKET_RECEIVED", "KERNEL_UPDATE", "PING_SUCCESS", "DAEMON_CHECK", "MEMORY_OPTIMIZED", "PROCESS_KILLED", "UPLINK_STABLE"];
            setInterval(() => {
                const div = document.createElement('div');
                div.innerText = `> ${msgs[Math.floor(Math.random()*msgs.length)]}: ${Math.floor(Math.random()*999)}`;
                log.prepend(div);
                if(log.children.length > 6) log.lastChild.remove();
            }, 2000);
        }

    </script>
</body>
</html>
